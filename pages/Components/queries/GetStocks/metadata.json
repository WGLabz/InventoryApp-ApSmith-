{
  "gitSyncId": "66f948a7fbfff512a970867b_0ca32afd-1d80-466c-a234-cae169da7cde",
  "id": "Components_GetStocks",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "SELECT \n    c.name,\n    c.component_id,\n    c.description,\n    c.date_added,\n    c.image_content,\n    c.image_type,\n    b.box_code,\n    c.category_id,\n    b.box_label,\n    ct.category_name,\n    b.box_id,\n    COALESCE((SELECT SUM(quantity_ordered) FROM order_parts WHERE component_id = c.component_id), 0) AS purchased,\n    COALESCE(\n        (SELECT SUM(quantity_used) FROM project_components WHERE component_id = c.component_id), \n        0\n    ) + COALESCE(\n        (SELECT SUM(quantity_used) FROM general_usage WHERE component_id = c.component_id),\n        0\n    ) AS used,\n    COALESCE(\n        (SELECT SUM(quantity_ordered) FROM order_parts WHERE component_id = c.component_id), \n        0\n    ) - (\n        COALESCE(\n            (SELECT SUM(quantity_used) FROM project_components WHERE component_id = c.component_id), \n            0\n        ) + COALESCE(\n            (SELECT SUM(quantity_used) FROM general_usage WHERE component_id = c.component_id),\n            0\n        )\n    ) AS stock\nFROM \n    components c\nLEFT JOIN \n    boxes b ON b.box_id = c.box_id\nLEFT JOIN \n    categories ct ON ct.category_id = c.category_id\nWHERE \n    c.name ILIKE '%{{ ComponentsTable.searchText }}%'\n    AND c.name != 'Taxes'\n    AND c.name != 'Shipping'\nORDER BY \n    {{ !!ComponentsTable.sortOrder.column ? ComponentsTable.sortOrder.column : 'name' }} \n    {{ !!ComponentsTable.sortOrder.order ? !!ComponentsTable.sortOrder.order : 'desc' }}\nLIMIT \n    {{ ComponentsTable.pageSize }} \nOFFSET \n    {{ (ComponentsTable.pageNo - 1) * ComponentsTable.pageSize }};\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "Koyeb Postgres DB",
      "isAutoGenerated": false,
      "name": "Koyeb Postgres DB",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "executeOnLoad": true,
    "name": "GetStocks",
    "pageId": "Components",
    "userSetOnLoad": false
  }
}